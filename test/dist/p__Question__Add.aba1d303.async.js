(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{vaSw:function(e,t,a){"use strict";var n=a("fbTi"),s=a("mZ4U");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("m7v9");var l=s(a("TznN"));a("kqFD");var i=s(a("LKgu"));a("SIi8");var r=s(a("xVmx"));a("Qh8y");var u=s(a("zKLI"));a("EW5u");var o=s(a("GAsO"));a("AjT3");var d=s(a("q+t8"));a("Ubc6");var c=s(a("far6")),f=s(a("3CjV"));a("rVLg");var p=s(a("EmQR")),g=s(a("43Yg")),h=s(a("/tCh")),m=s(a("scpF")),S=s(a("O/V9")),v=s(a("8aBX"));a("FxRQ");var y=s(a("2BUM"));a("KJSM");var E=s(a("3x7G")),C=n(a("i9FB")),I=a("LneV");a("SX54");var w=s(a("PC9P")),q=a("LGMr"),b=E.default.Item,L=y.default.TextArea,O=function(e){function t(e){var a;return(0,g.default)(this,t),a=(0,m.default)(this,(0,S.default)(t).call(this,e)),a.handleSubmit=function(e){var t=a.props,n=t.dispatch,s=t.form,l=a.state,i=l.answers,r=l.isMultipleSelection,u=l.questionId,o=[],d=function(e){e.success?u?p.default.success("\u4fee\u6539\u6210\u529f"):w.default.push("/empty"):p.default.error(e.msg||e.data),a.setState({loading:!1})};e.preventDefault(),s.validateFieldsAndScroll(function(e,t){if(!e){var s=0;if(i.forEach(function(e){e.isCorrect&&(s+=1)}),0===s)return void p.default.error("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6b63\u786e\u7b54\u6848!");o=i.filter(function(e){return!1===e.del});var l={},c="";if(u)l={questionId:u,sysUserId:localStorage.getItem("sysUserId"),type:t.type,isMultipleSelection:r,topic:t.topic,questions:t.questions},c="question/update";else{var f={type:t.type,isMultipleSelection:r,topic:t.topic,questions:t.questions,score:0,options:o};l={sysUserId:localStorage.getItem("sysUserId"),jsonString:JSON.stringify(f)},c="question/add"}a.setState({loading:!0}),n({type:c,payload:l,callback:d})}})},a.handleChangeRight=function(e){var t=a.state,n=t.answers,s=t.isMultipleSelection;if(1===s){var l=n[e].isCorrect;n[e].isCorrect=1===l?0:1}else n.forEach(function(e,t){n[t].isCorrect=0}),n[e].isCorrect=1;a.setState({answers:n})},a.onTypeChange=function(e){var t=e.target.value;a.setState({type:t})},a.onMultipChange=function(e){var t=e.target.value,n=a.state,s=n.oldAnswers,l=n.answers;a.setState({isMultipleSelection:t},function(){3===t?(a.setState({oldAnswers:JSON.parse(JSON.stringify(l))}),a.setAnswersLength()):s&&a.setState({answers:JSON.parse(JSON.stringify(s))})})},a.handleChangeAnswer=function(e,t){var n=a.state.answers,s=e.target.value;n[t].detail=s,a.setState({answers:n,oldAnswers:JSON.parse(JSON.stringify(n))})},a.handleAddAnswer=function(){var e=a.state.answers;e.push({detail:"",isCorrect:0,score:0,del:!1}),a.setState({answers:e})},a.handleDeleteOption=function(e){var t=a.state.answers,n=a.props.dispatch,s=t[e].id;if(t[e].del=!0,a.setState({answers:t,oldAnswers:JSON.parse(JSON.stringify(t))}),s){a.changeSpinLoading(!0);var l=function(e){e.success?p.default.success("\u5220\u9664\u6210\u529f"):p.default.error(e.data),a.changeSpinLoading(!1)},i={sysUserId:localStorage.getItem("sysUserId"),optionId:s};n({type:"question/delOption",payload:i,callback:l})}},a.handleEditOption=function(e){var t=a.state,n=t.answers,s=t.questionId,l=t.isMultipleSelection,i=t.lastCorrectIndex,r=a.props.dispatch,u=n[e],o=u.id,d=u.detail,c=u.isCorrect;if(o){a.changeSpinLoading(!0);var f=function(e){e.success?p.default.success("\u4fee\u6539\u6210\u529f"):p.default.error(e.data),a.changeSpinLoading(!1)},g={sysUserId:localStorage.getItem("sysUserId"),optionId:o,detail:d,isCorrect:c};r({type:"question/updateOption",payload:g,callback:f})}else{a.changeSpinLoading(!0);var h=function(e){e.success?(p.default.success("\u6dfb\u52a0\u6210\u529f"),a.getQuestionDetail()):p.default.error(e.data),a.changeSpinLoading(!1)},m={sysUserId:localStorage.getItem("sysUserId"),questionId:s,detail:d,isCorrect:c};r({type:"question/addOption",payload:m,callback:h})}if(2===l&&c&&null!==i){if(n[i].del)return;n[i].isCorrect=0,a.setState({answers:n},function(){a.handleEditOption(i),a.setState({lastCorrectIndex:e})})}},a.handleInputChange=function(e,t){var n=e.target.value;"topic"===t?a.setState({topic:n}):a.setState({questions:n})},a.state={spinLoading:!1,loading:!1,answers:[{detail:"",isCorrect:0,score:0,del:!1}],oldAnswers:[],type:1,isMultipleSelection:1,topic:"",questions:"",questionId:e.match.params.id,lastCorrectIndex:null},a}return(0,v.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){var e=this.state.questionId;e?this.getQuestionDetail():this.setAnswersLength()}},{key:"setAnswersLength",value:function(){var e=this.state,t=e.isMultipleSelection,a=e.topic,n=e.questions,s=this.props.form,l=[];if(setTimeout(function(){var e;s.resetFields(),s.setFieldsValue((e={},(0,f.default)(e,"topic",a),(0,f.default)(e,"questions",n),e))},0),3===t)for(var i=0;i<2;i+=1){var r=0===i?"\u662f":"\u5426";l.push({detail:r,isCorrect:0,score:0,del:!1})}else{for(var u=0;u<4;u+=1)l.push({detail:"",isCorrect:0,score:0,del:!1});this.setState({oldAnswers:JSON.parse(JSON.stringify(l))})}this.setState({answers:l})}},{key:"getQuestionDetail",value:function(){var e=this;this.changeSpinLoading(!0);var t=this.state.questionId,a=this.props.dispatch,n=function(t){if(e.changeSpinLoading(!1),t.success){var a=t.data.question,n=a.type,s=a.is_multiple_selection,l=a.topic,i=a.questions,r=[];if(t.data.option.forEach(function(t,a){2===s&&t.is_correct&&e.setState({lastCorrectIndex:a}),r.push({detail:t.detail,id:t.id,isCorrect:t.is_correct,publish_time:t.publish_time,question_id:t.question_id,score:t.score,del:!1})}),e.setState({type:n,isMultipleSelection:s,topic:l,questions:i,answers:r}),3===s){for(var u=[],o=0;o<4;o+=1)u.push({detail:"",isCorrect:0,score:0,del:!1});e.setState({oldAnswers:u})}else e.setState({oldAnswers:r})}},s={sysUserId:localStorage.getItem("sysUserId"),questionId:t};a({type:"question/detail",payload:s,callback:n})}},{key:"changeSpinLoading",value:function(e){this.setState({spinLoading:e})}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,n=t.answers,s=t.type,f=t.isMultipleSelection,p=t.topic,g=t.questions,h=t.questionId,m=t.spinLoading,S=this.props.form.getFieldDecorator;return C.default.createElement(c.default,null,C.default.createElement(E.default,Object.assign({},q.formItemLayout,{onSubmit:this.handleSubmit,style:{marginTop:20}}),C.default.createElement(b,{label:"\u9898\u76ee\u5206\u7c7b"},C.default.createElement(d.default,{gutter:24},C.default.createElement(o.default,{span:24},S("type",{initialValue:s,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u9898\u76ee\u5206\u7c7b"}]})(C.default.createElement(u.default.Group,{onChange:this.onTypeChange},C.default.createElement(u.default,{value:1},"\u884c\u6d4b\u9898"),C.default.createElement(u.default,{value:2},"\u804c\u4e1a\u9053\u5fb7\u9898"),C.default.createElement(u.default,{value:3},"\u7535\u529b\u5b89\u5168\u5e38\u8bc6\u9898")))))),C.default.createElement(b,{label:"\u9898\u578b"},C.default.createElement(d.default,{gutter:24},C.default.createElement(o.default,{span:12},S("isMultipleSelection",{initialValue:f,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7c7b\u578b"}]})(C.default.createElement(u.default.Group,{onChange:this.onMultipChange},C.default.createElement(u.default,{value:1},"\u591a\u9009\u9898"),C.default.createElement(u.default,{value:2},"\u5355\u9009\u9898"),C.default.createElement(u.default,{value:3},"\u5224\u65ad\u9898")))))),C.default.createElement(b,{label:"\u6807\u9898"},C.default.createElement(d.default,{gutter:24},C.default.createElement(o.default,{span:12},S("topic",{initialValue:p,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898"}]})(C.default.createElement(L,{onChange:function(t){return e.handleInputChange(t,"topic")},placeholder:"\u8bf7\u8f93\u5165\u6807\u9898"}))),C.default.createElement(o.default,{span:12}))),C.default.createElement(b,{label:"\u95ee\u9898"},C.default.createElement(d.default,{gutter:24},C.default.createElement(o.default,{span:12},S("questions",{initialValue:g,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u95ee\u9898"}]})(C.default.createElement(L,{onChange:function(t){return e.handleInputChange(t,"questions")},placeholder:"\u8bf7\u8f93\u5165\u6807\u9898"}))))),n.map(function(t,a){return t.del?null:C.default.createElement(b,Object.assign({key:a},q.formItemLayout,{label:"\u7b54\u6848"}),C.default.createElement(d.default,{gutter:24},C.default.createElement(o.default,{span:12},S("answer_".concat(a+1),{initialValue:t.detail,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7b54\u6848"}]})(C.default.createElement(L,{disabled:3===f,placeholder:"\u8bf7\u8f93\u5165\u7b54\u6848",onChange:function(t){e.handleChangeAnswer(t,a)}}))),C.default.createElement(o.default,{span:12},1===f?C.default.createElement(r.default,{checked:t.isCorrect,onChange:function(){e.handleChangeRight(a)}},"\u6b63\u786e\u7b54\u6848"):C.default.createElement(u.default,{style:{margin:0},checked:t.isCorrect,onChange:function(){e.handleChangeRight(a)}},"\u6b63\u786e\u7b54\u6848"),C.default.createElement(C.Fragment,null,3!==f?C.default.createElement("a",{style:{marginLeft:20},onClick:function(){e.handleDeleteOption(a)}},"\u5220\u9664"):null,h?C.default.createElement("a",{style:{marginLeft:20},onClick:function(){e.handleEditOption(a)}},t.id?"\u786e\u8ba4\u4fee\u6539":"\u65b0\u589e\u7b54\u6848"):null))))}),C.default.createElement(b,Object.assign({},q.submitFormLayout,{style:{marginTop:32}}),3!==f?C.default.createElement(i.default,{onClick:function(){return e.handleAddAnswer()}},"\u65b0\u589e\u7b54\u6848"):null),C.default.createElement(b,Object.assign({},q.submitFormLayout,{style:{marginTop:32}}),C.default.createElement(i.default,{type:"primary",htmlType:"submit",loading:a},"\u4fdd\u5b58\u9898\u76ee"))),C.default.createElement("div",{className:m?"spin":"spin-none"},C.default.createElement(l.default,{size:"large"})))}}]),t}(C.Component),A=E.default.create()((0,I.connect)(function(){return{}})(O));t.default=A}}]);